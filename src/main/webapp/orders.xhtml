<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:h="http://xmlns.jcp.org/jsf/html"
      xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
      xmlns:a="http://xmlns.jcp.org/jsf/passthrough"
      xmlns:f="http://java.sun.com/jsf/core">
<h:head/>
<h:body>
    <h2>#{ordersForUser.user.name} (#{ordersForUser.user.email}) orders:</h2>
    <ol>
        <ui:repeat value="#{ordersForUser.user.orders}" var="order">
            <li>
                <h:link value="Order ##{order.id} (#{order.orderedAt})" outcome="orderDetails?orderId=#{order.id}" />
            </li>
        </ui:repeat>
    </ol>
    <h:form>
        <hr></hr>
        <h3>Generate new user name</h3>
        <h:outputText value="Generated name: #{updateUserDetails.generatedName}" />
        <br></br>
        <h:commandButton value="Generate new name" actionListener="#{updateUserDetails.generateUserName}">
            <f:param name="userId" value="#{updateUserDetails.user.id}" />
        </h:commandButton>
    </h:form>
    <h:form>
        <hr></hr>
        <h3>Update user email</h3>
        <h:outputText value="Email: "/>
        <h:inputText a:placeholder="enter the value" value="#{updateUserDetails.user.email}" required="true" />
        <h:commandButton value="Update" action="#{updateUserDetails.updateUserEmail()}">
            <f:param name="userId" value="#{updateUserDetails.user.id}" />
        </h:commandButton>
        <h:outputText value="Email was already updated by other user. If you want to override it - try again" rendered="#{param['error'] == 'optimistic-lock-exception'}" />
        <hr></hr>
    </h:form>
    <h:form>
        <h3>Add new order</h3>
        <h:selectManyCheckbox value="#{ordersForUser.selectedProducts}">
            <f:selectItems value="#{products.allProducts}"
                           var="product"
                           itemLabel= "#{product.name} (#{product.price}â‚¬)"
                           itemValue="#{product.id}"/>
        </h:selectManyCheckbox>
        <h:commandButton value="Add order for the user"
                         actionListener="#{ordersForUser.createOrder}"
                         action="#{'orders?faces-redirect=true&amp;userId='.concat(ordersForUser.user.id)}">
            <f:param name="userId" value="#{ordersForUser.user.id}" />
        </h:commandButton>
        <hr></hr>
    </h:form>
    <h:link outcome="index" value="Back to users page"/>
</h:body>
</html>
